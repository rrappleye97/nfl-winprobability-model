<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 1 Data | Modeling Win Probability in NFL Games</title>
  <meta name="description" content="Chapter 1 Data | Modeling Win Probability in NFL Games">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 1 Data | Modeling Win Probability in NFL Games" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Data | Modeling Win Probability in NFL Games" />
  
  
  

<meta name="author" content="Robert Rappleye">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="literature-review.html">
<link rel="next" href="2-methodology.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="literature-review.html"><a href="literature-review.html"><i class="fa fa-check"></i>Literature Review</a></li>
<li class="chapter" data-level="1" data-path="1-data.html"><a href="1-data.html"><i class="fa fa-check"></i><b>1</b> Data</a></li>
<li class="chapter" data-level="2" data-path="2-methodology.html"><a href="2-methodology.html"><i class="fa fa-check"></i><b>2</b> Methodology</a><ul>
<li class="chapter" data-level="2.1" data-path="2-methodology.html"><a href="2-methodology.html#modeling-win-probability-on-kickoffs-and-pats"><i class="fa fa-check"></i><b>2.1</b> Modeling Win Probability on Kickoffs and PATs</a></li>
<li class="chapter" data-level="2.2" data-path="2-methodology.html"><a href="2-methodology.html#modeling-win-probability-on-first-and-ten"><i class="fa fa-check"></i><b>2.2</b> Modeling Win Probability on First and Ten</a></li>
<li class="chapter" data-level="2.3" data-path="2-methodology.html"><a href="2-methodology.html#modeling-win-probability-in-other-scenarios"><i class="fa fa-check"></i><b>2.3</b> Modeling Win Probability in Other Scenarios</a></li>
<li class="chapter" data-level="2.4" data-path="2-methodology.html"><a href="2-methodology.html#reasoning-behind-modeling-methodology"><i class="fa fa-check"></i><b>2.4</b> Reasoning Behind Modeling Methodology</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-results.html"><a href="3-results.html"><i class="fa fa-check"></i><b>3</b> Results</a></li>
<li class="chapter" data-level="4" data-path="4-applications.html"><a href="4-applications.html"><i class="fa fa-check"></i><b>4</b> Applications</a></li>
<li class="chapter" data-level="5" data-path="5-discussion.html"><a href="5-discussion.html"><i class="fa fa-check"></i><b>5</b> Discussion</a><ul>
<li class="chapter" data-level="5.1" data-path="5-discussion.html"><a href="5-discussion.html#conclusion"><i class="fa fa-check"></i><b>5.1</b> Conclusion</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="A-appendix.html"><a href="A-appendix.html"><i class="fa fa-check"></i><b>A</b> Appendix</a><ul>
<li class="chapter" data-level="A.1" data-path="A-appendix.html"><a href="A-appendix.html#qb-model"><i class="fa fa-check"></i><b>A.1</b> QB Model</a></li>
<li class="chapter" data-level="A.2" data-path="A-appendix.html"><a href="A-appendix.html#two-point-chart"><i class="fa fa-check"></i><b>A.2</b> Two Point Chart</a></li>
<li class="chapter" data-level="A.3" data-path="A-appendix.html"><a href="A-appendix.html#gbm-for-p_stopped"><i class="fa fa-check"></i><b>A.3</b> GBM for <span class="math inline">\(P_{stopped}\)</span></a></li>
<li class="chapter" data-level="A.4" data-path="A-appendix.html"><a href="A-appendix.html#downs-outcome-formulas"><i class="fa fa-check"></i><b>A.4</b> Downs Outcome Formulas</a></li>
<li class="chapter" data-level="A.5" data-path="A-appendix.html"><a href="A-appendix.html#gbm-for-p_penaltyreplay"><i class="fa fa-check"></i><b>A.5</b> GBM for <span class="math inline">\(P_{penaltyReplay}\)</span></a></li>
<li class="chapter" data-level="A.6" data-path="A-appendix.html"><a href="A-appendix.html#gbms-for-p_score"><i class="fa fa-check"></i><b>A.6</b> GBMs for <span class="math inline">\(P_{score}\)</span></a></li>
<li class="chapter" data-level="A.7" data-path="A-appendix.html"><a href="A-appendix.html#linear-models-for-delta-field-position_i-outcome_i"><i class="fa fa-check"></i><b>A.7</b> Linear Models for <span class="math inline">\(\Delta \: field \: position_{i^*} | outcome_{i^*}\)</span></a></li>
<li class="chapter" data-level="A.8" data-path="A-appendix.html"><a href="A-appendix.html#residual-plots-for-delta-field-position_i-outcome_i"><i class="fa fa-check"></i><b>A.8</b> Residual Plots for <span class="math inline">\(\Delta \: field \: position_{i^*} | outcome_{i^*}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modeling Win Probability in NFL Games</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Data</h1>
<p><strong>1.1 Description of the Play-by-Play Data</strong><br />
The play-by-play dataset comes from the NFL JSON API courtesy of the nflscrapR package, developed by Maksim Horowitz and Ron Yurko, which gives R users the API data in an easily digestible data frame. This package was used to compile a dataset of every play from the 2010 through 2017 NFL seasons. The dataset includes a number of variables that describe the game state including down, yards to go until a first down, yard line, and seconds remaining. The dataset also contains many variables that were helpful when it came to cleaning the data and adding features, including a description of each play that uses specific and consistent verbiage for different types of plays, making it easy to use text matching to search the dataset.</p>
<p><strong>1.2 Cleaning the Data</strong><br />
Though the nflscrapR package simplified the complexities of pulling data from the NFL JSON API and formatted it nicely in a dataframe, the actual contents of the data was still a bit raw. We matched each game to a dataset of game outcomes and pre-game point spreads<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> provided by The Prediction Tracker, and looked for discrepancies between the final score as listed in the play-by-play dataset and the point spread dataset. This allowed us to find games and plays in which the score was incremented incorrectly in the play-by-play dataset. We also looked for plays where the number of seconds remaining, the down or the field position changed from one play to the next in an incoherent manner to either fix or omit clearly erroneous entries.</p>
<p><strong>1.3 Incorporating Other Datasets</strong><br />
Though the play-by-play dataset contains all the information one might need as far as describing the game state is concerned, it does not contain any information to describe the teams playing in each game. To remedy this issue we consulted several other datasets. We grabbed grades assigned to quarterbacks from 2008 through 2017 by Pro Football Focus (PFF) and pulled age, the pick at which a player was drafted, passing attempts and ESPN’s Total QBR from Pro Football Reference (PFR) to use in a model that projects the grade a quarterback will receive in a given season<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>. We also downloaded the aforementioned point spreads and game outcomes from The Prediction Tracker. Lastly, we also pulled week by week Defense-adjusted Value Over Average (DVOA) ratings for offense, defense and special teams from Football Outsiders through the use of a web scraping script. Each of these descriptors of team (or player) strength was mapped to the rows of the dataset that contained the appropriate team and week match as either a “Home Team” descriptor or an “Away team” descriptor. An example of some of the predictors in the data might look something like this:</p>
<table>
<caption><span id="tab:sample-data">Table 1.1: </span>Sample Use of Outside Data</caption>
<thead>
<tr class="header">
<th align="right">Point Spread</th>
<th align="right">QB Home</th>
<th align="right">QB Away</th>
<th align="right">Off DVOA Home</th>
<th align="right">Off DVOA Away</th>
<th align="right">Def DVOA Home</th>
<th align="right">Def DVOA Away</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-3.0</td>
<td align="right">68.4</td>
<td align="right">80.9</td>
<td align="right">10.4</td>
<td align="right">2.3</td>
<td align="right">18.7</td>
<td align="right">1.4</td>
</tr>
<tr class="even">
<td align="right">4.5</td>
<td align="right">72.6</td>
<td align="right">69.9</td>
<td align="right">1.6</td>
<td align="right">-2.9</td>
<td align="right">17.5</td>
<td align="right">-5.4</td>
</tr>
<tr class="odd">
<td align="right">-3.0</td>
<td align="right">62.6</td>
<td align="right">76.9</td>
<td align="right">-17.7</td>
<td align="right">3.9</td>
<td align="right">0.0</td>
<td align="right">1.6</td>
</tr>
<tr class="even">
<td align="right">-5.5</td>
<td align="right">70.2</td>
<td align="right">91.5</td>
<td align="right">5.2</td>
<td align="right">9.7</td>
<td align="right">29.2</td>
<td align="right">11.3</td>
</tr>
<tr class="odd">
<td align="right">7.0</td>
<td align="right">72.9</td>
<td align="right">71.2</td>
<td align="right">19.8</td>
<td align="right">-1.8</td>
<td align="right">-26.6</td>
<td align="right">6.5</td>
</tr>
</tbody>
</table>
<p>Where “QB Home” and “QB Away” refer to the projected PFF grades for each team’s quarterback. The point spread, is the amount the home team is favored by<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>. These variables are transformed to describe the “possession team”—the team with the ball—and the defensive team when eventually used in models. Additionally, it is important to note that each value of DVOA is given a prior set to the pre-season projection of DVOA for the team in question. This prevents early season games from leading to extreme values for DVOA. The prior has a weight of four games<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>.</p>
<p><strong>1.4 Exploratory Data Analysis</strong><br />
To get a sense of whether or not the assumption made by PFR that the change in score differential at a given point in a game is normally distributed we plot the density of change in score differential for the first five minutes of each quarter. We only sample data points from kickoffs in order to give equal weight to each unique score, game pair in each dataset.</p>
<p><img src="thesis_files/figure-html/normality-eda-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We next take a look at how the absolute value of change in score differential scales as the game goes on, again sampling only from kickoffs.This should give a sense of whether or not variance scales as the game progresses.</p>
<p><img src="thesis_files/figure-html/variance-eda-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>We also take a look at the probability of the next scoring play being of a given type based on the yardline the ball is currently positioned at, this time for all first down plays. This will give an idea of whether the relationship between yard line and next scoring event is linear for different events.</p>
<p><img src="thesis_files/figure-html/scoring-plays-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Finally, we’ll take a look at how the probability of different outcomes on a given set of downs changes with the yards to go. We’ll output graphs for both first and second down.</p>
<p><img src="thesis_files/figure-html/downs-plays-1.png" width="672" style="display: block; margin: auto;" /><img src="thesis_files/figure-html/downs-plays-2.png" width="672" style="display: block; margin: auto;" /></p>

</div>
<div class="footnotes">
<hr />
<ol start="6">
<li id="fn6"><p>The pre-game lines were usually compiled on Sunday mornings according to the steward of the website so they will occasionally differ from the closing line<a href="1-data.html#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>This model is included in the appendix<a href="1-data.html#fnref7" class="footnote-back">↩</a></p></li>
<li id="fn8"><p>Negative amounts signal that the away team is favored<a href="1-data.html#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p>This prior was chosen as a sort of average of the game weights that Football Outsiders assigns to its pre-season projection prior which diminish as the season goes on and range from one to nine games<a href="1-data.html#fnref9" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="literature-review.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="2-methodology.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
